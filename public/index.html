<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <title>Pro Max Sizzu DP Gallery</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="site-header">
    <img src="assets/cover.jpg" alt="Cover Photo" class="cover-photo" />
    <h1>Pro Max Sizzu DP Gallery</h1>
  </header>
  
  <!-- Background animations -->
  <img src="assets/bird1.png" class="bird" style="top: 30px; animation-duration: 18s;" />
  <img src="assets/bird2.png" class="bird" style="top: 60px; animation-duration: 15s;" />
  <img src="assets/balloon1.png" class="balloon" style="left: 50px; animation-duration: 20s;" />
  <img src="assets/balloon2.png" class="balloon" style="left: 130px; animation-duration: 16s;" />

  <section class="upload-section">
    <input type="file" id="fileInput" multiple accept="image/*" />

    <button id="uploadSimpleBtn">Upload Photos</button>
    <button id="uploadUpscaleBtn">Upscale + Upload</button>
  </section>

  <section id="uploadLinks" class="upload-links"></section>

  <section id="gallery" class="gallery"></section>

  <script>
    async function uploadPhotos(files) {
      const formData = new FormData();
      for (const file of files) formData.append('photos', file);

      try {
        const res = await fetch('/upload', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();

        if (data.uploaded.length > 0) {
          alert(`Uploaded ${data.uploaded.length} photos.`);
          const linksDiv = document.getElementById('uploadLinks');
          linksDiv.innerHTML = '<h3>Uploaded Photo Links:</h3>';
          data.uploaded.forEach(url => {
            const a = document.createElement('a');
            a.href = url;
            a.innerText = url;
            a.target = '_blank';
            a.style.display = 'block';
            linksDiv.appendChild(a);
          });
        }
        fetchGallery();
      } catch (err) {
        alert('Upload failed: ' + err);
      }
    }

    async function upscaleAndUploadPhotos(files) {
      alert('Upscale + Upload feature coming soon!');
      uploadPhotos(files);
    }

    function createPhotoBox(src) {
      const div = document.createElement('div');
      div.classList.add('photo-box');

      const img = document.createElement('img');
      img.src = src;
      img.alt = 'Gallery Photo';
      img.classList.add('photo');

      const link = document.createElement('a');
      link.href = src;
      link.download = '';
      link.innerText = 'Download';
      link.classList.add('download-link');

      div.appendChild(img);
      div.appendChild(link);
      return div;
    }

    async function fetchGallery() {
      try {
        const res = await fetch('/gallery');
        const data = await res.json();
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = '';
        data.photos.forEach(src => {
          gallery.appendChild(createPhotoBox(src));
        });
      } catch (err) {
        console.error('Failed to fetch gallery', err);
      }
    }

    document.getElementById('uploadSimpleBtn').addEventListener('click', () => {
      const files = document.getElementById('fileInput').files;
      if (!files.length) return alert('Select photos first');
      uploadPhotos(files);
    });

    document.getElementById('uploadUpscaleBtn').addEventListener('click', () => {
      const files = document.getElementById('fileInput').files;
      if (!files.length) return alert('Select photos first');
      upscaleAndUploadPhotos(files);
    });

    window.onload = fetchGallery;
  </script>
</body>
</html>
