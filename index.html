<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pro Max Sizzu DP Gallery with Full Background Animation</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://unpkg.com/upscaler@latest/dist/upscaler.min.js"></script>
</head>
<body>

  <header class="site-header">
    <img src="assets/cover.jpg" alt="Cover Photo" class="cover-photo" />
    <h1>Pro Max Sizzu DP Gallery</h1>
  </header>

  <section class="upload-section">
    <input type="file" id="fileInput" multiple accept="image/*" />
    <button id="uploadBtn">Simple Upload</button>
    <button id="upscaleBtn">Upscale + Upload</button>
  </section>

  <section id="gallery" class="gallery"></section>
  <section id="latestLink" class="latest-link"></section>

  <script>
    const MAX_PHOTOS = 50;
    let photos = JSON.parse(localStorage.getItem("photos") || "[]");
    const upscaler = new Upscaler();

    // Background flying birds and balloons full screen
    function randomRange(min, max) { return Math.random() * (max - min) + min; }

    function createFlyingObjects() {
      const body = document.body;
      document.querySelectorAll('.bird,.balloon').forEach(el => el.remove());

      const birdCount = 12, balloonCount = 10;

      for(let i=0; i < birdCount; i++) {
        const bird = document.createElement('img');
        bird.src = 'assets/bird1.png';
        bird.className = 'bird';
        bird.style.top = `${randomRange(0, 100)}vh`;
        bird.style.left = `-${randomRange(10, 100)}px`;
        bird.style.animationDuration = `${randomRange(15, 30)}s`;
        bird.style.animationDelay = `${randomRange(0, 15)}s`;
        body.appendChild(bird);
      }
      for(let i=0; i < balloonCount; i++) {
        const balloon = document.createElement('img');
        balloon.src = 'assets/balloon1.png';
        balloon.className = 'balloon';
        balloon.style.left = `${randomRange(0, 100)}vw`;
        balloon.style.bottom = `-${randomRange(50, 150)}px`;
        balloon.style.animationDuration = `${randomRange(20, 35)}s`;
        balloon.style.animationDelay = `${randomRange(0, 35)}s`;
        body.appendChild(balloon);
      }
    }

    function cleanupPhotos() {
      const now = Date.now();
      photos = photos.filter(photo => now - photo.timestamp < 24*60*60*1000);
      localStorage.setItem('photos', JSON.stringify(photos));
    }

    function animateButtons() {
      anime({
        targets: '.upload-section button',
        translateX: [100, 0],
        opacity: [0, 1],
        delay: anime.stagger(200),
        duration: 1000,
        easing: 'easeOutExpo'
      });
    }

    function renderGallery() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      photos.forEach((photo, idx) => {
        const container = document.createElement('div');
        container.classList.add('photo-box');

        const img = document.createElement('img');
        img.src = photo.data;
        img.alt = `DP ${idx+1}`;
        img.classList.add('photo');

        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = 'Download';
        downloadBtn.classList.add('download-btn');
        downloadBtn.onclick = () => {
          const link = document.createElement('a');
          link.href = photo.data;
          link.download = `DP_${idx+1}.png`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };

        container.appendChild(img);
        container.appendChild(downloadBtn);
        gallery.appendChild(container);

        anime({
          targets: container,
          translateY: [-30, 0],
          opacity: [0, 1],
          delay: idx * 150,
          duration: 600,
          easing: 'easeOutElastic(1, .8)'
        });
      });
    }

    function showLatestLink(base64, idx) {
      const latest = document.getElementById('latestLink');
      latest.innerHTML = `
        <p>Upload successful! Share this link for direct download:</p>
        <a href="${base64}" download="DP_${idx+1}.png" class="download-link">Download DP_${idx+1}</a>
      `;
      anime({
        targets: '#latestLink',
        opacity: [0, 1],
        translateY: [-20, 0],
        duration: 800,
        easing: 'easeOutExpo'
      });
    }

    document.getElementById('uploadBtn').addEventListener('click', () => {
      const files = document.getElementById('fileInput').files;
      if (!files.length) return alert('Select photos first');
      if (photos.length + files.length > MAX_PHOTOS) return alert('Max 50 photos allowed');

      let loaded = 0;
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          photos.push({ data: e.target.result, timestamp: Date.now() });
          loaded++;
          if (loaded === files.length) {
            localStorage.setItem('photos', JSON.stringify(photos));
            renderGallery();
            showLatestLink(photos[photos.length-1].data, photos.length-1);
          }
        };
        reader.readAsDataURL(file);
      });
    });

    document.getElementById('upscaleBtn').addEventListener('click', async () => {
      const files = document.getElementById('fileInput').files;
      if (!files.length) return alert('Select photos first');
      if (photos.length + files.length > MAX_PHOTOS) return alert('Max 50 photos allowed');

      let loaded = 0;
      for (const file of files) {
        const base64 = await new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = e => resolve(e.target.result);
          reader.readAsDataURL(file);
        });
        try {
          const upscaled = await upscaler.upscale(base64);
          photos.push({ data: upscaled, timestamp: Date.now() });
        } catch {
          photos.push({ data: base64, timestamp: Date.now() });
        }
        loaded++;
        if (loaded === files.length) {
          localStorage.setItem('photos', JSON.stringify(photos));
          renderGallery();
          showLatestLink(photos[photos.length-1].data, photos.length-1);
        }
      }
    });

    cleanupPhotos();
    renderGallery();
    animateButtons();
    createFlyingObjects();
  </script>
</body>
</html>
