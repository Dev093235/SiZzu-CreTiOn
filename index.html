<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pro Max DP Gallery + Upscale</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://unpkg.com/upscaler@latest/dist/upscaler.min.js"></script>
</head>
<body>
  <header class="site-header">
    <img src="assets/cover.jpg" alt="Cover Photo" class="cover-photo" />
    <h1>Pro Max Sizzu DP Gallery</h1>
  </header>

  <section class="upload-section">
    <input type="file" id="fileInput" multiple accept="image/*"/>
    <button id="uploadBtn">Simple Upload</button>
    <button id="upscaleBtn">Upscale + Upload</button>
  </section>

  <section id="gallery" class="gallery"></section>
  <section id="latestLink" class="latest-link"></section>

  <script>
    const MAX_PHOTOS = 50;
    let photos = JSON.parse(localStorage.getItem("photos") || "[]");

    const upscaler = new Upscaler();

    function cleanupPhotos() {
      const now = Date.now();
      photos = photos.filter(p => now - p.timestamp < 24 * 60 * 60 * 1000);
      localStorage.setItem("photos", JSON.stringify(photos));
    }

    function animateButtons() {
      anime({
        targets: '.upload-section button',
        translateX: [100, 0],
        opacity: [0, 1],
        delay: anime.stagger(200),
        duration: 1000,
        easing: 'easeOutExpo'
      });
    }

    function renderGallery() {
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';
      photos.forEach((photo, idx) => {
        const container = document.createElement('div');
        container.classList.add('photo-box');

        const img = document.createElement('img');
        img.src = photo.data;
        img.alt = `DP ${idx + 1}`;
        img.classList.add('photo');

        const downloadBtn = document.createElement('button');
        downloadBtn.textContent = 'Download';
        downloadBtn.classList.add('download-btn');
        downloadBtn.onclick = () => {
          const link = document.createElement('a');
          link.href = photo.data;
          link.download = `DP_${idx + 1}.png`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        };

        container.appendChild(img);
        container.appendChild(downloadBtn);
        gallery.appendChild(container);

        anime({
          targets: container,
          translateY: [-30, 0],
          opacity: [0, 1],
          delay: idx * 150,
          duration: 600,
          easing: 'easeOutElastic(1, .8)'
        });
      });
    }

    function showLatestLink(base64, idx) {
      const latest = document.getElementById('latestLink');
      latest.innerHTML = `
        <p>Upload successful! Share this link for direct download:</p>
        <a href="${base64}" download="DP_${idx + 1}.png" class="download-link">Download DP_${idx + 1}</a>
      `;
      anime({
        targets: '#latestLink',
        opacity: [0, 1],
        translateY: [-20, 0],
        duration: 800,
        easing: 'easeOutExpo'
      });
    }

    document.getElementById('uploadBtn').addEventListener('click', () => {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) return alert('Select photos first');
      if (photos.length + fileInput.files.length > MAX_PHOTOS) return alert('Max 50 photos allowed.');

      let loaded = 0;
      Array.from(fileInput.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          photos.push({ data: e.target.result, timestamp: Date.now() });
          loaded++;
          if (loaded === fileInput.files.length) {
            localStorage.setItem("photos", JSON.stringify(photos));
            renderGallery();
            showLatestLink(photos[photos.length -1].data, photos.length -1);
          }
        };
        reader.readAsDataURL(file);
      });
    });

    document.getElementById('upscaleBtn').addEventListener('click', async () => {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput.files.length) return alert('Select photos first');
      if (photos.length + fileInput.files.length > MAX_PHOTOS) return alert('Max 50 photos allowed.');

      let loaded = 0;
      for (const file of fileInput.files) {
        const base64 = await new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = e => resolve(e.target.result);
          reader.readAsDataURL(file);
        });
        try {
          const upscaled = await upscaler.upscale(base64);
          photos.push({ data: upscaled, timestamp: Date.now() });
        } catch {
          photos.push({ data: base64, timestamp: Date.now() });
        }
        loaded++;
        if (loaded === fileInput.files.length) {
          localStorage.setItem("photos", JSON.stringify(photos));
          renderGallery();
          showLatestLink(photos[photos.length -1].data, photos.length -1);
        }
      }
    });

    cleanupPhotos();
    renderGallery();
    animateButtons();
  </script>
</body>
</html>
